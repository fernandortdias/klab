(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"3UXo":function(e,t,s){"use strict";var a=s("jWnI"),n=s.n(a);n.a},"6BcA":function(e,t,s){"use strict";var a=s("dbei"),n=s.n(a);n.a},I4zY:function(e,t,s){"use strict";var a=s("gyaY"),n=s.n(a);n.a},JFNH:function(e,t,s){"use strict";var a=s("ofTP"),n=s.n(a);n.a},M4pf:function(e,t,s){},aAhD:function(e,t,s){"use strict";var a=s("M4pf"),n=s.n(a);n.a},dbei:function(e,t,s){},gyaY:function(e,t,s){},jWnI:function(e,t,s){},"kmF/":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"column bg-red-1"},[s("div",{staticClass:"col row full-height bg-red-1"},[s("viewer")],1),s("div",{staticClass:"col-1 row bg-red-1"},[s("klab-log")],1),s("transition",{attrs:{appear:"","enter-active-class":"animated fadeInLeft","leave-active-class":"animated fadeOutLeft"}},[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.hasTree&&e.treeIsHidden,expression:"hasTree && treeIsHidden"}],staticClass:"fixed shadow-1",staticStyle:{left:".5em",top:"1.5em"},attrs:{color:"secondary",round:"",size:"md",icon:"ion-ios-bookmarks"},on:{click:function(t){e.treeIsHidden=!1}}})],1),s("transition",{attrs:{appear:"","enter-active-class":"animated fadeInLeft","leave-active-class":"animated fadeOutLeft"}},[s("q-card",{directives:[{name:"show",rawName:"v-show",value:e.hasTree&&!e.treeIsHidden,expression:"hasTree && !treeIsHidden"}],staticClass:"fixed bg-white shadow-1",staticStyle:{left:"1vw",top:"1vw"}},[s("q-card-title",{staticClass:"q-pa-sm"},[s("span",{staticClass:"q-pr-md"},[e._v(e._s(e.$t("label.treeTitle")))]),s("q-btn",{attrs:{color:"secondary",round:"",size:"sm",icon:"ion-ios-arrow-back"},on:{click:function(t){e.treeIsHidden=!0}}})],1),s("q-card-main",[s("klab-tree")],1)],1)],1),s("q-modal",{attrs:{minimized:"","no-esc-dismiss":"","no-backdrop-dismiss":"","content-css":{padding:"50px",minWidth:"50vw"},"content-classes":["text-center","bg-white"]},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.connectionState===e.$constants.CONNECTION_DOWN,expression:"connectionState === $constants.CONNECTION_DOWN"}],staticClass:"bg-white"},[s("div",{staticClass:"q-display-1 q-mb-md bg-warning round-modal"},[e._v(e._s(e.modalText))]),s("q-btn",{attrs:{color:"secondary"},on:{click:e.reconnect}},[e._v(e._s(e.$t("label.reconnect")))])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:e.connectionState===e.$constants.CONNECTION_ERROR||e.connectionState===e.$constants.CONNECTION_WORKING,expression:"connectionState === $constants.CONNECTION_ERROR ||\n        connectionState === $constants.CONNECTION_WORKING"}],staticClass:"bg-red"},[s("div",{staticClass:"q-display-1 q-mb-md bg-white round-modal text-primary text-bold"},[e._v("\n        "+e._s(e.modalText)+"\n      ")]),s("q-spinner-radio",{attrs:{color:"white",size:40}})],1)])],1)},n=[];a._withStripped=!0;var o=s("lSNA"),i=s.n(o),c=s("MVZn"),l=s.n(c),r=s("L2JU"),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"no-padding"},[s("q-tree",{ref:"klabTree",attrs:{nodes:e.tree,"node-key":"label","default-expand-all":"",selected:e.selected},on:{"update:selected":function(t){e.selected=t}}})],1)},u=[];d._withStripped=!0;var p={name:"klabTree",data:function(){return{selected:null}},computed:l()({},Object(r["c"])("data",["tree"])),methods:l()({},Object(r["b"])("data",["setSelected"])),watch:{selected:function(){this.setSelected(this.$refs.klabTree.getNodeByKey(this.selected))}}},g=p,m=(s("JFNH"),s("KHd+")),h=Object(m["a"])(g,d,u,!1,null,null,null),v=h.exports,f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"row full-width bg-gray-1"},[s("div",{staticClass:"col-1 no-padding stomp-status bg-gray-1"},[s("q-icon",{attrs:{name:e.connectionIndicator.icon,color:e.connectionIndicator.color}})],1),s("div",{staticClass:"col-3 message-log q-pt-xs stomp-message bg-gray-1"},[s("q-icon",{attrs:{name:"call_received",color:e.hasError?"negative":"positive"}}),s("span",{class:"text-"+(e.hasError?"negative":"positive")},[e._v(e._s(e.receivedMessage))])],1),s("div",{staticClass:"ic"}),s("div",{staticClass:"col-4 message-log q-pt-xs stomp-message bg-gray-1"},[s("q-icon",{attrs:{name:"call_made"}}),s("span",[e._v(e._s(e.sendedMessage))])],1),s("div",{staticClass:"col-4 message-log q-pt-xs stomp-message bg-gray-1"},[s("q-icon",{attrs:{name:"ion-at",color:e.lastLogActionMessage.color}}),s("span",{class:["text-"+e.lastLogActionMessage.color]},[e._v("\n      "+e._s(e.lastLogActionMessage.text)+" / "+e._s(e.lastLogActionMessage.time)+"\n    ")])],1)])},E=[];f._withStripped=!0;var b={name:"KLabLog",computed:l()({},Object(r["d"])("stomp",["connectionState"]),Object(r["c"])("stomp",["lastSendedMessage","lastReceivedMessage","queuedMessage"]),Object(r["c"])("view",["lastLogAction"]),{connectionIndicator:function(){var e,t;return this.connectionState===this.$constants.CONNECTION_WORKING?(e="sync",t="warning"):this.connectionState===this.$constants.CONNECTION_UP?(e="signal_wifi_4_bar",t="positive"):(e="signal_wifi_off",t="negative"),{icon:e,color:t}},hasError:function(){return this.lastReceivedMessage&&this.lastReceivedMessage.type===this.$constants.TYPE_ERROR},receivedMessage:function(){if(this.lastReceivedMessage){if(this.lastReceivedMessage.type===this.$constants.TYPE_ERROR)return""===this.lastReceivedMessage.message.reason?this.$t("label.klabUnknownError"):this.lastReceivedMessage.message.reason;if(""!==this.lastReceivedMessage.message.body){var e=JSON.parse(this.lastReceivedMessage.message.body);return"".concat(e.payload," - ").concat(this.lastReceivedMessage.date)}return"".concat(this.lastReceivedMessage.message.command," - ").concat(this.lastReceivedMessage.date)}return this.$t("label.klabNoMessage")},sendedMessage:function(){return this.queuedMessage?this.$t("label.klabMessagesToSend"):this.lastSendedMessage?"".concat(this.lastSendedMessage.date," [").concat(this.$helpers.formatExtent(this.lastSendedMessage.payload),"]")||this.$t("label.klabNoDate"):this.$t("label.klabNoMessage")},lastLogActionMessage:function(){var e=this.lastLogAction();return e&&e.payload?{text:e.payload.message||e.payload,time:e.time?e.time.format("HH:mm:ss"):"no time",color:e.type===this.$constants.TYPE_ERROR?"negative":e.type===this.$constants.TYPE_WARN?"warning":"positive"}:this.$t("label.klabNoMessage")}}),mounted:function(){}},O=b,N=(s("aAhD"),Object(m["a"])(O,f,E,!1,null,null,null)),_=N.exports,C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"col column no-padding relative-position"},[s("div",{ref:"viewer-container",staticClass:"col no-padding full-height full-width"},[s(e.type,{tag:"component",attrs:{data:e.data}})],1)])},T=[];C._withStripped=!0;var R=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"fit no-padding klab-viewer"},[s("vl-map",{ref:"map",attrs:{"load-tiles-while-animating":!0,"load-tiles-while-interacting":!0,"data-projection":"EPSG:4326"},on:{created:e.onMapCreated,moveend:function(t){e.onMoveEnd(t)}}},[s("vl-view",{attrs:{zoom:e.zoom,center:e.center,rotation:e.rotation},on:{"update:zoom":function(t){e.zoom=t},"update:center":function(t){e.center=t},"update:rotation":function(t){e.rotation=t}}}),s("vl-geoloc",{on:{"update:position":function(t){e.geolocPosition=t}},scopedSlots:e._u([{key:"default",fn:function(t){return[e.position?s("vl-feature",{attrs:{id:"position-feature"}},[s("vl-geom-point",{attrs:{coordinates:e.position}}),s("vl-style-box",[s("vl-style-icon",{attrs:{src:"statics/maps/marker.png",scale:.4,anchor:[.5,1]}})],1)],1):e._e()]}}])}),s("vl-layer-tile",{attrs:{id:"osm"}},[s("vl-source-sputnik")],1)],1),s("q-resize-observable",{on:{resize:e.handleResize}})],1)},w=[];R._withStripped=!0;var S=s("Kw5r"),y=s("ADia"),I=s.n(y),M=s("kmQV"),$=(s("K2lC"),s("DW2E"),s("sSqL")),x=s("I2m6"),A=s("wd/R"),P=s.n(A);function k(e,t,s,a,n){var o=x["b"].validateJsonSchema(a,s);return{validated:o,body:{messageClass:e,type:t,payloadClass:s,payload:a,identity:n,timestamp:P()().valueOf(),inResponseTo:null}}}var L=Object.freeze({CLASS_USERCONTEXTCHANGE:"UserContextChange",PAYLOAD_CLASS_SPATIALEXTENT:"SpatialExtent",PAYLOAD_CLASS_TEMPORALEXTENT:"TemporalExtent",TYPE_REGIONOFINTEREST:"RegionOfInterest",TYPE_PERIODOFINTEREST:"PeriodOfInterest",TYPE_DEBUG:"Debug",TYPE_INFO:"Info",TYPE_WARNING:"Warning",TYPE_ERROR:"Error"}),q={REGION_OF_INTEREST:function(e,t){return k(L.CLASS_USERCONTEXTCHANGE,L.TYPE_REGIONOFINTEREST,L.PAYLOAD_CLASS_SPATIALEXTENT,$["b"].toKlabExtent(e),t)},PERIOD_OF_INTEREST:{messageClass:"UserContextChange",type:"PeriodOfInterest",payloadClass:"TemporalExtent"},DEBUG:{messageClass:"Message",type:"Debug",payloadClass:""},ERROR:{messageClass:"Message",type:"Error",payloadClass:""},WARNING:{messageClass:"Message",type:"Warning",payloadClass:""},INFO:{messageClass:"Message",type:"Info",payloadClass:""}};S["a"].use(M["a"]);var Y={name:"MapViewer",data:function(){return{zoom:7,center:[0,0],rotation:0,geolocPosition:void 0,map:null}},computed:l()({position:function(){return this.leafSelected?[this.leafSelected.lng,this.leafSelected.lat]:this.geolocPosition}},Object(r["c"])("data",["leafSelected","session"])),methods:l()({},Object(r["b"])("view",["pushLogAction"]),{onMapCreated:function(){console.log("Created map!: ".concat(this.map)),this.map=this.$refs.map.$map},handleResize:function(){console.log("handleResize called!!!"),this.map.updateSize()},onMoveEnd:function(e){var t=e.map,s=null;try{s=q.REGION_OF_INTEREST(I.a.proj.transformExtent(t.getView().calculateExtent(t.getSize()),"EPSG:3857","EPSG:4326"),this.session)}catch(e){this.pushLogAction({type:this.$constants.TYPE_ERROR,payload:e})}s&&s.body&&(this.sendStompMessage(s.body),this.pushLogAction({type:s.validated?this.$constants.TYPE_INFO:this.$constants.TYPE_WARN,payload:{message:"Message ".concat(s.validated?"":"not"," validated"),other:s}}))}}),watch:{geolocPosition:function(){this.center=this.geolocPosition,console.log("Encontrada posicion: ".concat(this.geolocPosition))},position:function(){this.center=this.position}}},j=Y,z=(s("6BcA"),Object(m["a"])(j,R,w,!1,null,null,null)),W=z.exports,D={data:function(){return{fullHeight:1e3,type:"MapViewer",data:""}},computed:l()({},Object(r["c"])("data",["viewerLayout","mainViewerId"]),{savedColClass:function(){var e=0,t=1;return t>0&&(e=2*(Math.floor(12/t)+1)),{saved:"col-".concat(e),empties:"col-".concat(12-e)}}}),methods:{layoutUpdated:function(e){console.log("Layout updated: ".concat(JSON.stringify(e)))}},watch:{mainViewerId:function(){console.log("He cambiado")}},components:{MapViewer:W},mounted:function(){}},G=D,H=(s("3UXo"),Object(m["a"])(G,C,T,!1,null,null,null)),U=H.exports,F={name:"IndexPage",data:function(){return{treeIsHidden:!1}},computed:l()({},Object(r["c"])("data",["hasTree","hasSaved"]),Object(r["c"])("stomp",["connectionState"]),{modalVisible:function(){return this.connectionState!==this.$constants.CONNECTION_UP},modalText:function(){var e;return(e={},i()(e,this.$constants.CONNECTION_DOWN,this.$t("messages.connectionClosed")),i()(e,this.$constants.CONNECTION_WORKING,this.$t("messages.connectionWorking")),i()(e,this.$constants.CONNECTION_ERROR,this.$t("errors.connectionError")),e)[this.connectionState]}}),components:{klabTree:v,klabLog:_,viewer:U},watch:{}},V=F,K=(s("I4zY"),Object(m["a"])(V,a,n,!1,null,"4c475bd8",null));t["default"]=K.exports},ofTP:function(e,t,s){}}]);