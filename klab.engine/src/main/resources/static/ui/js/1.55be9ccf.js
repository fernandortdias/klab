(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"6BcA":function(e,t,a){"use strict";var s=a("dbei"),n=a.n(s);n.a},"6VIN":function(e,t,a){},"6Z2i":function(e,t,a){"use strict";var s=a("L5SV"),n=a.n(s);n.a},JFNH:function(e,t,a){"use strict";var s=a("ofTP"),n=a.n(s);n.a},L5SV:function(e,t,a){},M4pf:function(e,t,a){},aAhD:function(e,t,a){"use strict";var s=a("M4pf"),n=a.n(s);n.a},dbei:function(e,t,a){},hcpY:function(e,t,a){"use strict";var s=a("6VIN"),n=a.n(s);n.a},"kmF/":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"column bg-red-1"},[a("div",{staticClass:"col row full-height bg-red-1"},[a("viewer")],1),a("div",{staticClass:"col-1 row bg-red-1"},[a("klab-log")],1),a("transition",{attrs:{appear:"","enter-active-class":"animated fadeInLeft","leave-active-class":"animated fadeOutLeft"}},[a("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.hasTree&&e.treeIsHidden,expression:"hasTree && treeIsHidden"}],staticClass:"fixed shadow-1",staticStyle:{left:".5em",top:"1.5em"},attrs:{color:"primary",round:"",size:"md",icon:"ion-ios-bookmarks"},on:{click:e.showTree}})],1),a("transition",{attrs:{appear:"","enter-active-class":"animated fadeInLeft","leave-active-class":"animated fadeOutLeft"}},[a("q-card",{directives:[{name:"show",rawName:"v-show",value:e.hasTree&&!e.treeIsHidden,expression:"hasTree && !treeIsHidden"},{name:"draggable",rawName:"v-draggable",value:e.draggableValue,expression:"draggableValue"}],staticClass:"fixed bg-white shadow-1",staticStyle:{left:"1vw",top:"1vw"}},[a("q-card-title",{ref:"dr-handler",staticClass:"q-pa-sm bg-primary"},[a("span",{staticClass:"q-pr-md text-white"},[e._v(e._s(e.$t("label.treeTitle")))]),a("q-btn",{attrs:{color:"primary",round:"",size:"sm",icon:"ion-ios-arrow-back"},on:{click:e.hideTree}})],1),a("q-card-main",[a("klab-tree")],1)],1)],1),a("q-modal",{attrs:{minimized:"","no-esc-dismiss":"","no-backdrop-dismiss":"","content-css":{padding:"50px",minWidth:"50vw"},"content-classes":["text-center","bg-white"]},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.connectionState===e.$constants.CONNECTION_DOWN,expression:"connectionState === $constants.CONNECTION_DOWN"}],staticClass:"bg-white"},[a("div",{staticClass:"q-display-1 q-mb-md bg-warning round-modal"},[e._v(e._s(e.modalText))]),a("q-btn",{attrs:{color:"secondary"},on:{click:e.reconnect}},[e._v(e._s(e.$t("label.reconnect")))])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.connectionState===e.$constants.CONNECTION_ERROR||e.connectionState===e.$constants.CONNECTION_WORKING,expression:"connectionState === $constants.CONNECTION_ERROR ||\n        connectionState === $constants.CONNECTION_WORKING"}],staticClass:"bg-red"},[a("div",{staticClass:"q-display-1 q-mb-md bg-white round-modal text-primary text-bold"},[e._v("\n        "+e._s(e.modalText)+"\n      ")]),a("q-spinner-radio",{attrs:{color:"white",size:40}})],1)])],1)},n=[];s._withStripped=!0;var i=a("lSNA"),o=a.n(i),l=a("MVZn"),c=a.n(l),r=a("L2JU"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"no-padding"},[a("q-tree",{ref:"klabTree",attrs:{nodes:e.tree,"node-key":"label","default-expand-all":"",selected:e.selected},on:{"update:selected":function(t){e.selected=t}}})],1)},u=[];d._withStripped=!0;var m={name:"klabTree",data:function(){return{selected:null}},computed:c()({},Object(r["c"])("data",["tree"])),methods:c()({},Object(r["b"])("data",["setLeafSelected"])),watch:{selected:function(){this.setLeafSelected(this.$refs.klabTree.getNodeByKey(this.selected))}}},g=m,p=(a("JFNH"),a("KHd+")),h=Object(p["a"])(g,d,u,!1,null,null,null),v=h.exports,f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"row full-width bg-gray-1"},[a("div",{staticClass:"col-1 no-padding stomp-status bg-gray-1"},[a("q-icon",{attrs:{name:e.connectionIndicator.icon,color:e.connectionIndicator.color}})],1),a("div",{staticClass:"col-3 message-log q-pt-xs stomp-message bg-gray-1"},[a("q-icon",{attrs:{name:"call_received",color:e.hasError?"negative":"positive"}}),a("span",{class:"text-"+(e.hasError?"negative":"positive")},[e._v(e._s(e.receivedMessage))])],1),a("div",{staticClass:"ic"}),a("div",{staticClass:"col-4 message-log q-pt-xs stomp-message bg-gray-1"},[a("q-icon",{attrs:{name:"call_made"}}),a("span",[e._v(e._s(e.sendedMessage))])],1),a("div",{staticClass:"col-4 message-log q-pt-xs stomp-message bg-gray-1"},[a("q-icon",{attrs:{name:"ion-at",color:e.lastLogActionMessage.color}}),a("span",{class:["text-"+e.lastLogActionMessage.color]},[e._v("\n      "+e._s(e.lastLogActionMessage.text)+" / "+e._s(e.lastLogActionMessage.time)+"\n    ")])],1)])},b=[];f._withStripped=!0;var E={name:"KLabLog",computed:c()({},Object(r["d"])("stomp",["connectionState"]),Object(r["c"])("stomp",["lastSendedMessage","lastReceivedMessage","queuedMessage"]),Object(r["c"])("view",["lastLogAction"]),{connectionIndicator:function(){var e,t;return this.connectionState===this.$constants.CONNECTION_WORKING?(e="sync",t="warning"):this.connectionState===this.$constants.CONNECTION_UP?(e="signal_wifi_4_bar",t="positive"):(e="signal_wifi_off",t="negative"),{icon:e,color:t}},hasError:function(){return this.lastReceivedMessage&&this.lastReceivedMessage.type===this.$constants.TYPE_ERROR},receivedMessage:function(){if(this.lastReceivedMessage){if(this.lastReceivedMessage.type===this.$constants.TYPE_ERROR)return""===this.lastReceivedMessage.message.reason?this.$t("label.klabUnknownError"):this.lastReceivedMessage.message.reason;if(""!==this.lastReceivedMessage.message.body){var e=JSON.parse(this.lastReceivedMessage.message.body);return"".concat(e.payload," - ").concat(this.lastReceivedMessage.date)}return"".concat(this.lastReceivedMessage.message.command," - ").concat(this.lastReceivedMessage.date)}return this.$t("label.klabNoMessage")},sendedMessage:function(){return this.queuedMessage?this.$t("label.klabMessagesToSend"):this.lastSendedMessage?"".concat(this.lastSendedMessage.date," [").concat(this.$helpers.formatExtent(this.lastSendedMessage.payload),"]")||this.$t("label.klabNoDate"):this.$t("label.klabNoMessage")},lastLogActionMessage:function(){var e=this.lastLogAction();return e&&e.payload?{text:e.payload.message||e.payload,time:e.time?e.time.format("HH:mm:ss"):"no time",color:e.type===this.$constants.TYPE_ERROR?"negative":e.type===this.$constants.TYPE_WARN?"warning":"positive"}:this.$t("label.klabNoMessage")}}),mounted:function(){}},N=E,O=(a("aAhD"),Object(p["a"])(N,f,b,!1,null,null,null)),_=O.exports,w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"no-padding relative-position full-width"},e._l(e.viewerLayout,function(t){return a("div",{key:t.idx,class:["no-padding",t.main?"absolute-top full-height full-width":"absolute thumb-view"],style:e.viewerStyle(t)},[t.main?e._e():a("div",{staticClass:"thumb-viewer-title absolute-top"},[a("div",{staticClass:"relative-position"},[a("div",{staticClass:"thumb-viewer-label float-left q-ma-sm"},[e._v("\n        "+e._s(t.data.label||e.$t("label.unknownLabel"))+"\n      ")]),a("div",{staticClass:"float-right q-ma-sm"},[a("q-btn",{staticClass:"shadow-1",attrs:{round:"",color:"red-6",size:"xs",icon:"ion-ios-arrow-up"},on:{click:function(a){e.setMainViewer(t.idx)}}})],1)])]),a(t.type,{tag:"component",attrs:{observation:t.data}})],1)}))},C=[];w._withStripped=!0;var T=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"fit no-padding klab-viewer"},[a("vl-map",{ref:"map",attrs:{"load-tiles-while-animating":!0,"load-tiles-while-interacting":!0,"data-projection":"EPSG:4326"},on:{created:e.onMapCreated,moveend:function(t){e.onMoveEnd(t)}}},[a("vl-view",{attrs:{zoom:e.zoom,center:e.position,"center.sync":"center",rotation:e.rotation},on:{"update:rotation":function(t){e.rotation=t}}}),a("vl-geoloc",{scopedSlots:e._u([{key:"default",fn:function(t){return[e.position?a("vl-feature",{attrs:{id:"position-feature"}},[a("vl-geom-point",{attrs:{coordinates:e.position}}),a("vl-style-box",[a("vl-style-icon",{attrs:{src:"statics/maps/marker.png",scale:.4,anchor:[.5,1]}})],1)],1):e._e()]}}])}),a("vl-layer-tile",{attrs:{id:"osm"}},[a("vl-source-sputnik")],1)],1),a("q-resize-observable",{on:{resize:e.handleResize}})],1)},R=[];T._withStripped=!0;var y=a("Kw5r"),S=a("ADia"),I=a.n(S),M=a("kmQV"),x=(a("K2lC"),a("DW2E"),a("sSqL")),$=a("I2m6"),A=a("wd/R"),L=a.n(A);function k(e,t,a,s,n){var i=$["b"].validateJsonSchema(s,a);return{validated:i,body:{messageClass:e,type:t,payloadClass:a,payload:s,identity:n,timestamp:L()().valueOf(),inResponseTo:null}}}var P=Object.freeze({CLASS_USERCONTEXTCHANGE:"UserContextChange",PAYLOAD_CLASS_SPATIALEXTENT:"SpatialExtent",PAYLOAD_CLASS_TEMPORALEXTENT:"TemporalExtent",TYPE_REGIONOFINTEREST:"RegionOfInterest",TYPE_PERIODOFINTEREST:"PeriodOfInterest",TYPE_DEBUG:"Debug",TYPE_INFO:"Info",TYPE_WARNING:"Warning",TYPE_ERROR:"Error"}),q={REGION_OF_INTEREST:function(e,t){return k(P.CLASS_USERCONTEXTCHANGE,P.TYPE_REGIONOFINTEREST,P.PAYLOAD_CLASS_SPATIALEXTENT,x["b"].toKlabExtent(e),t)},PERIOD_OF_INTEREST:{messageClass:"UserContextChange",type:"PeriodOfInterest",payloadClass:"TemporalExtent"},DEBUG:{messageClass:"Message",type:"Debug",payloadClass:""},ERROR:{messageClass:"Message",type:"Error",payloadClass:""},WARNING:{messageClass:"Message",type:"Warning",payloadClass:""},INFO:{messageClass:"Message",type:"Info",payloadClass:""}};y["a"].use(M["a"]);var V={name:"MapViewer",props:["observation"],data:function(){return{center:[0,0],rotation:0,map:null,leaf:this.observation}},computed:c()({position:function(){return[this.leaf.lng,this.leaf.lat]},zoom:function(){return this.leaf.zoom}},Object(r["c"])("data",["session"])),methods:c()({},Object(r["b"])("view",["pushLogAction"]),{onMapCreated:function(){console.log("Created map!: ".concat(this.map)),this.map=this.$refs.map.$map},handleResize:function(){console.log("handleResize called!!!"),this.map.updateSize()},onMoveEnd:function(e){var t=e.map,a=null;try{a=q.REGION_OF_INTEREST(I.a.proj.transformExtent(t.getView().calculateExtent(t.getSize()),"EPSG:3857","EPSG:4326"),this.session)}catch(e){this.pushLogAction({type:this.$constants.TYPE_ERROR,payload:e})}a&&a.body&&(this.sendStompMessage(a.body),this.pushLogAction({type:a.validated?this.$constants.TYPE_INFO:this.$constants.TYPE_WARN,payload:{message:"Message ".concat(a.validated?"":"not"," validated"),other:a}}))}}),sockets:{onmessage:function(){console.log("Received frame in mapviewer.vue")}},watch:{},beforeDestroy:function(){console.log("ME DESTRUYEN")},mounted:function(){console.log("Observation: ".concat(this.leaf.lat,",").concat(this.leaf.lng,",z ").concat(this.leaf.zoom," - ").concat(this.leaf.label))}},D=V,Y=(a("6BcA"),Object(p["a"])(D,T,R,!1,null,null,null)),j=Y.exports,z=[],G={computed:c()({},Object(r["c"])("data",["viewerLayout","mainViewer"])),methods:c()({},Object(r["b"])("data",["setMainViewer"]),{viewerStyle:function(e){return e.main?"":(z.push(e),0===z.length?"left: 0":"left: ".concat(200*(z.length-1)+10*(z.length-1),"px"))}}),watch:{mainViewer:function(){z=[]}},components:{MapViewer:j},beforeUpdate:function(){z=[]},mounted:function(){z=[]}},W=G,H=(a("hcpY"),Object(p["a"])(W,w,C,!1,null,"5f352162",null)),F=H.exports,U=a("on+m"),K={name:"IndexPage",data:function(){return{treeIsHidden:!1,draggableValue:{handle:void 0,resetInitialPos:!1}}},computed:c()({},Object(r["c"])("data",["hasTree"]),Object(r["c"])("stomp",["connectionState"]),{modalVisible:function(){return this.connectionState!==this.$constants.CONNECTION_UP},modalText:function(){var e;return(e={},o()(e,this.$constants.CONNECTION_DOWN,this.$t("messages.connectionClosed")),o()(e,this.$constants.CONNECTION_WORKING,this.$t("messages.connectionWorking")),o()(e,this.$constants.CONNECTION_ERROR,this.$t("errors.connectionError")),e)[this.connectionState]}}),methods:{hideTree:function(){this.draggableValue.resetInitialPos=!1,this.treeIsHidden=!0},showTree:function(){this.draggableValue.resetInitialPos=!0,this.treeIsHidden=!1}},directives:{Draggable:U["Draggable"]},components:{klabTree:v,klabLog:_,viewer:F},watch:{},mounted:function(){this.draggableValue.handle=this.$refs["dr-handler"]}},J=K,B=(a("6Z2i"),Object(p["a"])(J,s,n,!1,null,"8d48add2",null));t["default"]=B.exports},ofTP:function(e,t,a){}}]);