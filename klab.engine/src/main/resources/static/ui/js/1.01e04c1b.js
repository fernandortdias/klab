(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"0vB6":function(e,t,s){},"6BcA":function(e,t,s){"use strict";var a=s("dbei"),n=s.n(a);n.a},Hfyr:function(e,t,s){"use strict";var a=s("0vB6"),n=s.n(a);n.a},JFNH:function(e,t,s){"use strict";var a=s("ofTP"),n=s.n(a);n.a},M4pf:function(e,t,s){},Osbd:function(e,t,s){},ZsJx:function(e,t,s){"use strict";var a=s("Osbd"),n=s.n(a);n.a},aAhD:function(e,t,s){"use strict";var a=s("M4pf"),n=s.n(a);n.a},dbei:function(e,t,s){},"kmF/":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"column bg-red-1"},[s("div",{staticClass:"col row full-height bg-red-1"},[s("viewer")],1),s("div",{staticClass:"col-1 row bg-red-1"},[s("klab-log")],1),s("transition",{attrs:{appear:"","enter-active-class":"animated fadeInLeft","leave-active-class":"animated fadeOutLeft"}},[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.hasTree&&e.treeIsHidden,expression:"hasTree && treeIsHidden"}],staticClass:"fixed shadow-1",staticStyle:{left:".5em",top:"1.5em"},attrs:{color:"secondary",round:"",size:"md",icon:"ion-ios-bookmarks"},on:{click:function(t){e.treeIsHidden=!1}}})],1),s("transition",{attrs:{appear:"","enter-active-class":"animated fadeInLeft","leave-active-class":"animated fadeOutLeft"}},[s("q-card",{directives:[{name:"show",rawName:"v-show",value:e.hasTree&&!e.treeIsHidden,expression:"hasTree && !treeIsHidden"}],staticClass:"fixed bg-white shadow-1",staticStyle:{left:"1vw",top:"1vw"}},[s("q-card-title",{staticClass:"q-pa-sm"},[s("span",{staticClass:"q-pr-md"},[e._v(e._s(e.$t("label.treeTitle")))]),s("q-btn",{attrs:{color:"secondary",round:"",size:"sm",icon:"ion-ios-arrow-back"},on:{click:function(t){e.treeIsHidden=!0}}})],1),s("q-card-main",[s("klab-tree")],1)],1)],1),s("q-modal",{attrs:{minimized:"","no-esc-dismiss":"","no-backdrop-dismiss":"","content-css":{padding:"50px",minWidth:"50vw"},"content-classes":["text-center","bg-white"]},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.connectionState===e.$constants.CONNECTION_DOWN,expression:"connectionState === $constants.CONNECTION_DOWN"}],staticClass:"bg-white"},[s("div",{staticClass:"q-display-1 q-mb-md bg-warning round-modal"},[e._v(e._s(e.modalText))]),s("q-btn",{attrs:{color:"secondary"},on:{click:e.reconnect}},[e._v(e._s(e.$t("label.reconnect")))])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:e.connectionState===e.$constants.CONNECTION_ERROR||e.connectionState===e.$constants.CONNECTION_WORKING,expression:"connectionState === $constants.CONNECTION_ERROR ||\n        connectionState === $constants.CONNECTION_WORKING"}],staticClass:"bg-red"},[s("div",{staticClass:"q-display-1 q-mb-md bg-white round-modal text-primary text-bold"},[e._v("\n        "+e._s(e.modalText)+"\n      ")]),s("q-spinner-radio",{attrs:{color:"white",size:40}})],1)])],1)},n=[];a._withStripped=!0;var o=s("lSNA"),i=s.n(o),c=s("MVZn"),l=s.n(c),r=s("L2JU"),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"no-padding"},[s("q-tree",{ref:"klabTree",attrs:{nodes:e.tree,"node-key":"label","default-expand-all":"",selected:e.selected},on:{"update:selected":function(t){e.selected=t}}})],1)},u=[];d._withStripped=!0;var m={name:"klabTree",data:function(){return{selected:null}},computed:l()({},Object(r["c"])("data",["tree"])),methods:l()({},Object(r["b"])("data",["setLeafSelected"])),watch:{selected:function(){this.setLeafSelected(this.$refs.klabTree.getNodeByKey(this.selected))}}},p=m,g=(s("JFNH"),s("KHd+")),v=Object(g["a"])(p,d,u,!1,null,null,null),h=v.exports,f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"row full-width bg-gray-1"},[s("div",{staticClass:"col-1 no-padding stomp-status bg-gray-1"},[s("q-icon",{attrs:{name:e.connectionIndicator.icon,color:e.connectionIndicator.color}})],1),s("div",{staticClass:"col-3 message-log q-pt-xs stomp-message bg-gray-1"},[s("q-icon",{attrs:{name:"call_received",color:e.hasError?"negative":"positive"}}),s("span",{class:"text-"+(e.hasError?"negative":"positive")},[e._v(e._s(e.receivedMessage))])],1),s("div",{staticClass:"ic"}),s("div",{staticClass:"col-4 message-log q-pt-xs stomp-message bg-gray-1"},[s("q-icon",{attrs:{name:"call_made"}}),s("span",[e._v(e._s(e.sendedMessage))])],1),s("div",{staticClass:"col-4 message-log q-pt-xs stomp-message bg-gray-1"},[s("q-icon",{attrs:{name:"ion-at",color:e.lastLogActionMessage.color}}),s("span",{class:["text-"+e.lastLogActionMessage.color]},[e._v("\n      "+e._s(e.lastLogActionMessage.text)+" / "+e._s(e.lastLogActionMessage.time)+"\n    ")])],1)])},b=[];f._withStripped=!0;var E={name:"KLabLog",computed:l()({},Object(r["d"])("stomp",["connectionState"]),Object(r["c"])("stomp",["lastSendedMessage","lastReceivedMessage","queuedMessage"]),Object(r["c"])("view",["lastLogAction"]),{connectionIndicator:function(){var e,t;return this.connectionState===this.$constants.CONNECTION_WORKING?(e="sync",t="warning"):this.connectionState===this.$constants.CONNECTION_UP?(e="signal_wifi_4_bar",t="positive"):(e="signal_wifi_off",t="negative"),{icon:e,color:t}},hasError:function(){return this.lastReceivedMessage&&this.lastReceivedMessage.type===this.$constants.TYPE_ERROR},receivedMessage:function(){if(this.lastReceivedMessage){if(this.lastReceivedMessage.type===this.$constants.TYPE_ERROR)return""===this.lastReceivedMessage.message.reason?this.$t("label.klabUnknownError"):this.lastReceivedMessage.message.reason;if(""!==this.lastReceivedMessage.message.body){var e=JSON.parse(this.lastReceivedMessage.message.body);return"".concat(e.payload," - ").concat(this.lastReceivedMessage.date)}return"".concat(this.lastReceivedMessage.message.command," - ").concat(this.lastReceivedMessage.date)}return this.$t("label.klabNoMessage")},sendedMessage:function(){return this.queuedMessage?this.$t("label.klabMessagesToSend"):this.lastSendedMessage?"".concat(this.lastSendedMessage.date," [").concat(this.$helpers.formatExtent(this.lastSendedMessage.payload),"]")||this.$t("label.klabNoDate"):this.$t("label.klabNoMessage")},lastLogActionMessage:function(){var e=this.lastLogAction();return e&&e.payload?{text:e.payload.message||e.payload,time:e.time?e.time.format("HH:mm:ss"):"no time",color:e.type===this.$constants.TYPE_ERROR?"negative":e.type===this.$constants.TYPE_WARN?"warning":"positive"}:this.$t("label.klabNoMessage")}}),mounted:function(){}},O=E,N=(s("aAhD"),Object(g["a"])(O,f,b,!1,null,null,null)),_=N.exports,C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"no-padding relative-position full-width"},e._l(e.viewerLayout,function(t){return s("div",{key:t.idx,class:["no-padding",t.main?"absolute-top full-height full-width":"absolute thumb-view"],style:e.viewerStyle(t)},[t.main?e._e():s("div",{staticClass:"thumb-viewer-title absolute-top"},[s("div",{staticClass:"relative-position"},[s("div",{staticClass:"thumb-viewer-label float-left q-ma-sm"},[e._v("\n        "+e._s(t.data.label||e.$t("label.unknownLabel"))+"\n      ")]),s("div",{staticClass:"float-right q-ma-sm"},[s("q-btn",{staticClass:"shadow-1",attrs:{round:"",color:"red-6",size:"xs",icon:"ion-ios-arrow-up"},on:{click:function(s){e.setMainViewer(t.idx)}}})],1)])]),s(t.type,{tag:"component",attrs:{observation:t.data}})],1)}))},w=[];C._withStripped=!0;var T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"fit no-padding klab-viewer"},[s("vl-map",{ref:"map",attrs:{"load-tiles-while-animating":!0,"load-tiles-while-interacting":!0,"data-projection":"EPSG:4326"},on:{created:e.onMapCreated,moveend:function(t){e.onMoveEnd(t)}}},[s("vl-view",{attrs:{zoom:e.zoom,center:e.position,"center.sync":"center",rotation:e.rotation},on:{"update:rotation":function(t){e.rotation=t}}}),s("vl-geoloc",{scopedSlots:e._u([{key:"default",fn:function(t){return[e.position?s("vl-feature",{attrs:{id:"position-feature"}},[s("vl-geom-point",{attrs:{coordinates:e.position}}),s("vl-style-box",[s("vl-style-icon",{attrs:{src:"statics/maps/marker.png",scale:.4,anchor:[.5,1]}})],1)],1):e._e()]}}])}),s("vl-layer-tile",{attrs:{id:"osm"}},[s("vl-source-sputnik")],1)],1),s("q-resize-observable",{on:{resize:e.handleResize}})],1)},R=[];T._withStripped=!0;var y=s("Kw5r"),S=s("ADia"),I=s.n(S),M=s("kmQV"),x=(s("K2lC"),s("DW2E"),s("sSqL")),$=s("I2m6"),A=s("wd/R"),k=s.n(A);function L(e,t,s,a,n){var o=$["b"].validateJsonSchema(a,s);return{validated:o,body:{messageClass:e,type:t,payloadClass:s,payload:a,identity:n,timestamp:k()().valueOf(),inResponseTo:null}}}var P=Object.freeze({CLASS_USERCONTEXTCHANGE:"UserContextChange",PAYLOAD_CLASS_SPATIALEXTENT:"SpatialExtent",PAYLOAD_CLASS_TEMPORALEXTENT:"TemporalExtent",TYPE_REGIONOFINTEREST:"RegionOfInterest",TYPE_PERIODOFINTEREST:"PeriodOfInterest",TYPE_DEBUG:"Debug",TYPE_INFO:"Info",TYPE_WARNING:"Warning",TYPE_ERROR:"Error"}),q={REGION_OF_INTEREST:function(e,t){return L(P.CLASS_USERCONTEXTCHANGE,P.TYPE_REGIONOFINTEREST,P.PAYLOAD_CLASS_SPATIALEXTENT,x["b"].toKlabExtent(e),t)},PERIOD_OF_INTEREST:{messageClass:"UserContextChange",type:"PeriodOfInterest",payloadClass:"TemporalExtent"},DEBUG:{messageClass:"Message",type:"Debug",payloadClass:""},ERROR:{messageClass:"Message",type:"Error",payloadClass:""},WARNING:{messageClass:"Message",type:"Warning",payloadClass:""},INFO:{messageClass:"Message",type:"Info",payloadClass:""}};y["a"].use(M["a"]);var j={name:"MapViewer",props:["observation"],data:function(){return{center:[0,0],rotation:0,map:null,leaf:this.observation}},computed:l()({position:function(){return[this.leaf.lng,this.leaf.lat]},zoom:function(){return this.leaf.zoom}},Object(r["c"])("data",["session"])),methods:l()({},Object(r["b"])("view",["pushLogAction"]),{onMapCreated:function(){console.log("Created map!: ".concat(this.map)),this.map=this.$refs.map.$map},handleResize:function(){console.log("handleResize called!!!"),this.map.updateSize()},onMoveEnd:function(e){var t=e.map,s=null;try{s=q.REGION_OF_INTEREST(I.a.proj.transformExtent(t.getView().calculateExtent(t.getSize()),"EPSG:3857","EPSG:4326"),this.session)}catch(e){this.pushLogAction({type:this.$constants.TYPE_ERROR,payload:e})}s&&s.body&&(this.sendStompMessage(s.body),this.pushLogAction({type:s.validated?this.$constants.TYPE_INFO:this.$constants.TYPE_WARN,payload:{message:"Message ".concat(s.validated?"":"not"," validated"),other:s}}))}}),sockets:{onmessage:function(){console.log("Received frame in mapviewer.vue")}},watch:{},beforeDestroy:function(){console.log("ME DESTRUYEN")},mounted:function(){console.log("Observation: ".concat(this.leaf.lat,",").concat(this.leaf.lng,",z ").concat(this.leaf.zoom," - ").concat(this.leaf.label))}},z=j,D=(s("6BcA"),Object(g["a"])(z,T,R,!1,null,null,null)),Y=D.exports,G=[],H={computed:l()({},Object(r["c"])("data",["viewerLayout","mainViewer"])),methods:l()({},Object(r["b"])("data",["setMainViewer"]),{viewerStyle:function(e){return e.main?"":(G.push(e),0===G.length?"left: 0":"left: ".concat(200*(G.length-1)+10*(G.length-1),"px"))}}),watch:{mainViewer:function(){G=[]}},components:{MapViewer:Y},beforeUpdate:function(){G=[]},mounted:function(){}},W=H,V=(s("ZsJx"),Object(g["a"])(W,C,w,!1,null,"16cfdb63",null)),F=V.exports,U={name:"IndexPage",data:function(){return{treeIsHidden:!1}},computed:l()({},Object(r["c"])("data",["hasTree"]),Object(r["c"])("stomp",["connectionState"]),{modalVisible:function(){return this.connectionState!==this.$constants.CONNECTION_UP},modalText:function(){var e;return(e={},i()(e,this.$constants.CONNECTION_DOWN,this.$t("messages.connectionClosed")),i()(e,this.$constants.CONNECTION_WORKING,this.$t("messages.connectionWorking")),i()(e,this.$constants.CONNECTION_ERROR,this.$t("errors.connectionError")),e)[this.connectionState]}}),components:{klabTree:h,klabLog:_,viewer:F},watch:{}},K=U,J=(s("Hfyr"),Object(g["a"])(K,a,n,!1,null,"80e2ecee",null));t["default"]=J.exports},ofTP:function(e,t,s){}}]);